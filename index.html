<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ExpenseTracker Pro</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="icon" type="image/png" href="favicon.png">

  <link rel="stylesheet" href="styles.css">

</head>
<body>
  <!-- Encabezado -->
  <header class="app-header">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
          <img src="image.png" alt="Logo" style="height:36px;width:36px;margin-right:10px; border-radius:50%; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          background-color: #000000;">
          <div class="brand">ExpenseTracker Pro</div>
        </div>
        <button class="theme-toggle" id="themeToggle" aria-label="Activate dark mode">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- Contenido principal -->
  <main class="container my-4">
    <div class="row">
      <!-- Panel izquierdo -->
      <div class="col-lg-5 mb-4">
        <div class="sidebar-sticky">
        <!-- Ingresos: pestañas Monedas / Billetes -->
        <div class="card mb-3">
          <div class="card-header pb-0">
            <ul class="nav nav-tabs card-header-tabs" role="tablist">
              <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-monedas" type="button">Monedas</button>
              </li>
              <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-billetes" type="button">Billetes</button>
              </li>
              <!-- Ingresos (fusionados) eliminado según solicitud -->
            </ul>
          </div>
          <div class="card-body tab-content">
            <div class="tab-pane fade show active" id="tab-monedas">
              <!-- formulario + tabla de monedas -->
              <form id="coinIncomeForm">
                <div class="mb-3">
                  <label for="coinType" class="form-label">Tipo de moneda</label>
                  <select class="form-select" id="coinType" required>
                    <option value="" selected disabled>Selecciona tipo</option>
                    <option value="1000">$1.000</option>
                    <option value="500">$500</option>
                    <option value="200">$200</option>
                    <option value="100">$100</option>
                    <option value="50">$50</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="coinQuantity" class="form-label">Cantidad</label>
                  <input type="number" class="form-control" id="coinQuantity" min="1" placeholder="Cantidad de monedas" required>
                </div>
                <button type="submit" class="btn btn-success w-100">Agregar ingreso</button>
                <hr>
                <h6 class="mt-3">Ingresos registrados</h6>
                <div class="table-responsive">
                  <table class="table table-striped table-hover" id="coinIncomeTable">
                    <thead>
                      <tr>
                        <th>Moneda</th>
                        <th>Cantidad</th>
                        <th>Total</th>
                        <th>Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="coinIncomeBody"></tbody>
                  </table>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-2">
                  <strong>Total general: <span id="coinIncomeTotal">$0</span></strong>
                    <div class="btn-group btn-group-sm">
                    <button id="printCoinIncomeBtn" class="btn btn-outline-primary"><i class="fa-solid fa-print btn-icon" aria-hidden="true"></i>Imprimir</button>
                    <button id="saveCoinTableImageBtn" class="btn btn-outline-success"><i class="fa-solid fa-download btn-icon" aria-hidden="true"></i>Guardar como imagen</button>
                  </div>
                </div>
              </form>
            </div>
            <div class="tab-pane fade" id="tab-billetes">
              <!-- formulario + tabla de billetes -->
              <form id="billIncomeForm">
                <div class="mb-3">
                  <label for="billType" class="form-label">Tipo de billete</label>
                  <select class="form-select" id="billType" required>
                    <option value="" selected disabled>Selecciona tipo</option>
                    <option value="2000">$2.000</option>
                    <option value="5000">$5.000</option>
                    <option value="10000">$10.000</option>
                    <option value="20000">$20.000</option>
                    <option value="50000">$50.000</option>
                    <option value="100000">$100.000</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="billQuantity" class="form-label">Cantidad</label>
                  <input type="number" class="form-control" id="billQuantity" min="1" placeholder="Cantidad de billetes" required>
                </div>
                <button type="submit" class="btn btn-success w-100">Agregar ingreso</button>
                <hr>
                <h6 class="mt-3">Ingresos registrados</h6>
                <div class="table-responsive">
                  <table class="table table-striped table-hover" id="billIncomeTable">
                    <thead>
                      <tr>
                        <th>Billete</th>
                        <th>Cantidad</th>
                        <th>Total</th>
                        <th>Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="billIncomeBody"></tbody>
                  </table>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-2">
                  <strong>Total general: <span id="billIncomeTotal">$0</span></strong>
                  <div class="btn-group btn-group-sm">
                    <button id="printBillIncomeBtn" class="btn btn-outline-primary"><i class="fa-solid fa-print btn-icon" aria-hidden="true"></i>Imprimir</button>
                    <button id="saveBillTableImageBtn" class="btn btn-outline-success"><i class="fa-solid fa-download btn-icon" aria-hidden="true"></i>Guardar como imagen</button>
                  </div>
                </div>
              </form>
            </div>
            <!-- Pestaña de ingresos fusionados eliminada -->
          </div>
        </div>

        

        <!-- Tarjeta para agregar gasto -->
        <div class="card mb-3">
          <div class="card-header">
            <h5 class="mb-0">Agregar gasto</h5>
          </div>
          <div class="card-body">
            <form id="expenseForm">
              <div class="mb-3">
                <label for="expenseDate" class="form-label"><i class="fa-solid fa-calendar"></i> Fecha</label>
                <input type="text" class="form-control" id="expenseDate" placeholder="Selecciona fecha">
                <div class="invalid-feedback">Por favor selecciona una fecha válida.</div>
              </div>
              <div class="mb-3">
                <label for="expenseCategory" class="form-label">Categoría</label>
                <select class="form-select" id="expenseCategory">
                  <option value="" selected disabled>Selecciona categoría</option>
                  <option value="Food">Alimentación</option>
                  <option value="Transportation">Transporte</option>
                  <option value="Housing">Vivienda</option>
                  <option value="Utilities">Servicios</option>
                  <option value="Entertainment">Entretenimiento</option>
                  <option value="Shopping">Compras</option>
                  <option value="Healthcare">Salud</option>
                  <option value="Travel">Viajes</option>
                  <option value="Education">Educación</option>
                  <option value="Other">Otro</option>
                </select>
                <div class="invalid-feedback">Por favor selecciona una categoría.</div>
              </div>
              <div class="mb-3">
                <label for="expenseDescription" class="form-label">Descripción</label>
                <input type="text" class="form-control" id="expenseDescription" placeholder="Ingresa descripción">
                <div class="invalid-feedback">Por favor ingresa una descripción.</div>
              </div>
              <div class="mb-3">
                <label for="expenseAmount" class="form-label">Monto</label>
                <div class="input-group">
                  <span class="input-group-text">$</span>
                  <input type="number" class="form-control" id="expenseAmount" placeholder="0.00" step="0.01" min="0">
                </div>
                <div class="invalid-feedback">Por favor ingresa un monto válido.</div>
              </div>
              <button type="submit" class="btn btn-primary w-100">Agregar gasto</button>
            </form>
          </div>
        </div>
        
        <!-- Tarjeta para importar desde imagen (pequeña) -->
        <div class="card collapsible-card mb-3" style="left: 2px; top: -8px;">
          <div class="card-header d-flex justify-content-between align-items-center" role="button" data-bs-toggle="collapse" href="#importImageCollapse">
            <h5 class="mb-0">Importar desde imagen</h5>
            <i class="fas fa-chevron-up toggle-icon"></i>
          </div>
          <div class="card-body collapse show" id="importImageCollapse">
            <div class="mb-3">
              <label for="importImageFile" class="form-label">Selecciona una imagen de tu tabla impresa</label>
              <input class="form-control" type="file" id="importImageFile" accept="image/*">
              <small class="text-muted">Formatos soportados: .jpg, .jpeg, .png, .webp</small>
            </div>
            <div id="importedImagePreview" class="mb-2" style="display:none;">
              <h6 class="mt-3 mb-2">Vista previa de la imagen importada</h6>
              <img id="importedImage" src="" alt="Imagen importada" style="max-width:100%;border:1px solid #ccc;padding:4px;">
            </div>
            <div id="importImageStatus"></div>
          </div>
        </div>
        </div>
        </div>

      <!-- Panel derecho -->
      <div class="col-lg-7">
        <div class="card" style="top: -1px; left: 9px;">
          <div class="card-header p-0">
            <ul class="nav nav-tabs" id="visualizationTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab" aria-controls="dashboard" aria-selected="true">Dashboard</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="data-table-tab" data-bs-toggle="tab" data-bs-target="#dataTable" type="button" role="tab" aria-controls="dataTable" aria-selected="false">Tabla de datos</button>
              </li>
            </ul>
          </div>
          <div class="card-body">
            <div class="tab-content" id="visualizationTabsContent">
              <!-- Pestaña Dashboard -->
              <div class="tab-pane fade show active" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                <div class="row g-3">
                  <!-- Gráfico mensual (fila completa) -->
                  <div class="col-12">
                    <div class="card h-100">
                      <div class="card-header"><h5 class="mb-0">Gasto mensual</h5></div>
                      <div class="card-body">
                        <div class="chart-container">
                          <div class="d-none justify-content-center align-items-center h-100" id="monthlyChartLoader">
                            <div class="spinner-border text-primary" role="status">
                              <span class="visually-hidden">Cargando...</span>
                            </div>
                          </div>
                          <canvas id="monthlyChart"></canvas>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Segunda fila: dos columnas 50/50 -->
                  <div class="col-md-6">
                    <div class="card h-100">
                      <div class="card-header"><h5 class="mb-0">Distribución por categoría</h5></div>
                      <div class="card-body">
                        <div class="chart-container">
                          <canvas id="categoryChart"></canvas>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="card h-100">
                      <div class="card-header"><h5 class="mb-0">Gasto acumulado en el tiempo</h5></div>
                      <div class="card-body">
                        <div class="chart-container">
                          <div class="d-none justify-content-center align-items-center h-100" id="timelineChartLoader">
                            <div class="spinner-border text-primary" role="status">
                              <span class="visually-hidden">Cargando...</span>
                            </div>
                          </div>
                          <canvas id="timelineChart"></canvas>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Pestaña Tabla de datos -->
              <div class="tab-pane fade" id="dataTable" role="tabpanel" aria-labelledby="data-table-tab">
                <div class="table-container">
                  <table class="table table-striped table-hover tabla-gastos" id="expensesTable">
                    <thead>
                      <tr>
                        <th>
                          <i class="fa-solid fa-calendar"></i> Fecha
                          <div><input type="text" class="form-control form-control-sm filter-input" id="dateFilter" placeholder="Filtrar"></div>
                        </th>
                        <th>
                          Categoría
                          <div>
                            <select class="form-select form-select-sm filter-input" id="categoryFilter">
                              <option value="">Todas</option>
                            </select>
                          </div>
                        </th>
                        <th>
                          Descripción
                          <div><input type="text" class="form-control form-control-sm filter-input" id="descriptionFilter" placeholder="Filtrar"></div>
                        </th>
                        <th>
                          Monto
                          <div><input type="text" class="form-control form-control-sm filter-input" id="amountFilter" placeholder="Filtrar"></div>
                        </th>
                        <th>Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="expensesTableBody">
                      <!-- Los datos de gastos se insertarán aquí dinámicamente en español -->
                    </tbody>
                  </table>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-3">
                  <div>
                    <span>Mostrando <span id="currentRows">0</span> de <span id="totalRows">0</span> registros</span>
                  </div>
                  <nav aria-label="Navegación de la tabla de gastos">
                    <ul class="pagination pagination-sm" id="tablePagination">
                      <!-- Los enlaces de paginación se insertarán aquí -->
                    </ul>
                  </nav>
                </div>
                <div class="d-flex gap-2">
                  <button id="printExpensesBtn" class="btn btn-outline-primary w-100 mt-2"><i class="fa-solid fa-print btn-icon" aria-hidden="true"></i>Imprimir gastos</button>
                  <button id="saveTableImageBtn" class="btn btn-outline-success w-100 mt-2"><i class="fa-solid fa-download btn-icon" aria-hidden="true"></i>Guardar tabla como imagen</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Pie de página -->
  <footer class="footer">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <strong>Total de gastos: </strong>
          <span id="totalExpenses">$0.00</span>
          <span class="ms-3"><strong>Total este año:</strong> <span id="totalYear">$0.00</span></span>
        </div>
        <button id="resetAllBtn" class="btn btn-outline-danger"><i class="fa-solid fa-arrow-rotate-right btn-icon" aria-hidden="true"></i>Reiniciar todo</button>
        <button id="printAllBtn" class="btn btn-outline-primary ms-2"><i class="fa-solid fa-print btn-icon" aria-hidden="true"></i>Imprimir todo</button>
      </div>
    </div>
  </footer>

  <!-- Toast de éxito -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
    <div id="successToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          <i class="fas fa-check-circle me-2"></i> ¡Gasto agregado exitosamente!
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Cerrar"></button>
      </div>
    </div>
  </div>

  <!-- Icono de ayuda -->
  <button class="help-icon" data-bs-toggle="modal" data-bs-target="#helpModal" aria-label="Open help modal">
    <i class="fas fa-question"></i>
  </button>

  <!-- Modal de ayuda -->
  <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="helpModalLabel">Cómo usar ExpenseTracker Pro</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <h6>Agregar gastos</h6>
          <p>Completa el formulario a la izquierda con los detalles del gasto y haz clic en "Agregar gasto".</p>

          <h6>Ingresos en monedas</h6>
          <p>Registra tus ingresos en monedas seleccionando el tipo y cantidad. Los totales se actualizarán automáticamente.</p>  

          <h6>Ingresos en billetes</h6>
          <p>Registra tus ingresos en billetes de forma similar a las monedas. Puedes editar la cantidad haciendo clic en la celda correspondiente.</p>   

          <h6>Gráficos</h6>
          <p>En la pestaña "Dashboard", verás gráficos que muestran tus gastos mensuales, distribución por categoría y gasto acumulado en el tiempo.</p> 
          
           <h6>Tabla de datos</h6>  
          <p>En la pestaña "Tabla de datos", verás una tabla con todos tus gastos. Puedes filtrar y ordenar por fecha, categoría, descripción y monto.</p>            

          <h6>Importar gastos</h6>
          <p>Puedes importar gastos desde una imagen de tu tabla impresa. Usa el botón "Guardar tabla como imagen" para descargar la tabla generada y luego impórtala usando "Importar desde imagen". Se mostrará la vista previa de la imagen seleccionada.</p>
          
          <h6>Ver datos</h6>
          <p>Cambia entre la pestaña "Dashboard" para ver los gráficos y "Tabla de datos" para ver y editar tus gastos.</p>
          
          <h6>Editar datos</h6>
          <p>En la tabla, haz clic en cualquier celda para editar su contenido. Haz clic en el icono de papelera para eliminar un registro.</p>
          <h6>Exportar tabla como imagen</h6>
          <p>Puedes guardar la tabla de gastos como imagen haciendo clic en el botón "Guardar tabla como imagen". Luego podrás importarla en otro momento usando la opción de imagen.</p>
          
          <h6>Filtrar y ordenar</h6>
          <p>Usa los filtros en la parte superior de cada columna para filtrar datos. Haz clic en los encabezados para ordenar.</p>

          <h6>Imprimir gastos</h6>
          <p>Haz clic en el botón "Imprimir gastos" para generar una vista imprimible de tus gastos.</p>  

          <h6>Imprimir ingresos</h6>
          <p>Haz clic en los botones "Imprimir ingresos" para generar una vista imprim  ible de tus ingresos en monedas o billetes.</p> 
          
          <h6>Reiniciar datos</h6>
          <p>Haz clic en el botón "Reiniciar todo" en el pie de página para borrar todos los datos de gastos.</p>
          
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Reiniciar datos con opciones -->
  <div class="modal fade" id="resetModal" tabindex="-1" aria-labelledby="resetModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="resetModalLabel">Reiniciar datos</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <p>Selecciona qué datos quieres reiniciar. Esto eliminará permanentemente los datos seleccionados.</p>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="resetExpensesChk" checked>
            <label class="form-check-label" for="resetExpensesChk">Gastos</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="resetCoinsChk" checked>
            <label class="form-check-label" for="resetCoinsChk">Ingresos en monedas</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="resetBillsChk" checked>
            <label class="form-check-label" for="resetBillsChk">Ingresos en billetes</label>
          </div>
          <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" value="" id="resetSelectAll">
            <label class="form-check-label" for="resetSelectAll">Seleccionar todo</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button id="confirmResetBtn" type="button" class="btn btn-danger">Reiniciar seleccionados</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Dependencias -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  
  <script src="script.js"></script>

</body>
</html>